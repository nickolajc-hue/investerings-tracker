<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invest-Master Pro</title>

    <style>
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --danger: #dc2626;
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: var(--bg); 
            padding: 20px; 
            color: var(--text);
            line-height: 1.5;
        }

        .container { max-width: 1000px; margin: auto; }
        
        /* Fane-system */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { 
            padding: 12px 24px; 
            cursor: pointer; 
            border-radius: 8px; 
            border: none; 
            background: #e2e8f0; 
            font-weight: bold;
            transition: all 0.2s;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Cards & Layout */
        .card { 
            background: var(--card-bg); 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            margin-bottom: 20px; 
        }
        .cards-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 20px; 
        }

        h1, h2 { margin-top: 0; }
        
        /* Input & Knapper */
        .input-group { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        input { 
            padding: 10px; 
            border-radius: 6px; 
            border: 1px solid #ddd; 
            font-size: 14px;
        }
        button { 
            padding: 10px 20px; 
            border-radius: 6px; 
            border: none; 
            cursor: pointer; 
            font-weight: bold; 
            background: var(--primary);
            color: white;
        }
        button:hover { opacity: 0.9; }
        .btn-update { background: var(--success); }
        .btn-delete { background: var(--danger); padding: 5px 10px; font-size: 12px; }

        /* Tabel */
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: right; }
        th:first-child, td:first-child { text-align: left; }
        
        .positive { color: var(--success); font-weight: bold; }
        .negative { color: var(--danger); font-weight: bold; }

        /* Nyheder */
        .news-item { border-bottom: 1px solid #eee; padding: 15px 0; }
        .news-item:last-child { border: none; }
        .news-title { 
            font-weight: bold; 
            color: var(--text); 
            text-decoration: none; 
            font-size: 16px; 
            display: block; 
            margin-bottom: 8px; 
        }
        .news-title:hover { color: var(--primary); }
        .news-meta { font-size: 13px; color: var(--text-light); display: flex; align-items: center; gap: 10px; }
        .news-date { 
            font-size: 11px; 
            color: var(--text-light); 
            background: #f1f5f9; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-weight: bold;
        }
    </style>
</head>

<body>
<div class="container">
    <h1>üìä Invest-Master Pro</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('dashboard', this)">üè† Dashboard</button>
        <button class="tab-btn" onclick="showTab('news', this); loadNews();">üì∞ Nyheder</button>
    </div>

    <div id="dashboard" class="tab-content active">
        <div class="cards-grid">
            <div class="card">Investeret<br><b id="invested">0 kr</b></div>
            <div class="card">V√¶rdi<br><b id="value">0 kr</b></div>
            <div class="card">Afkast<br><b id="profit">0 kr</b></div>
            <div class="card">Afkast %<br><b id="profitPct">0%</b></div>
        </div>

        <div class="card">
            <h2>‚ûï Tilf√∏j investering</h2>
            <div class="input-group">
                <input id="name" placeholder="Ticker (f.eks. AAPL)">
                <input id="quantity" type="number" placeholder="Antal">
                <input id="buyPrice" type="number" placeholder="K√∏bspris">
                <input id="currentPrice" type="number" placeholder="Nuv. pris">
                <input id="targetPct" type="number" placeholder="M√•l %">
            </div>
            <button onclick="addInvestment()">Tilf√∏j til portef√∏lje</button>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2>üìÅ Din Allokering</h2>
                <button class="btn-update" onclick="updateAllPrices()" id="updateBtn">üîÑ Opdater live-priser</button>
            </div>
            <table>
                <thead>
                    <tr><th>Aktiv</th><th>V√¶rdi</th><th>Nuv %</th><th>M√•l %</th><th>Just√©r</th><th></th></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="news" class="tab-content">
        <div class="card">
            <h2>Seneste nyt for dine tickers</h2>
            <div id="newsList">Tilf√∏j aktier for at se nyheder...</div>
        </div>
    </div>
</div>

<script>
    let investments = JSON.parse(localStorage.getItem("investments")) || [];
    const fmt = new Intl.NumberFormat('da-DK', { style: 'currency', currency: 'DKK', maximumFractionDigits: 0 });

    function showTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btn.classList.add('active');
    }

    function save() { localStorage.setItem("investments", JSON.stringify(investments)); }

    function addInvestment() {
        const name = document.getElementById("name").value.toUpperCase();
        const qty = parseFloat(document.getElementById("quantity").value);
        const buy = parseFloat(document.getElementById("buyPrice").value);
        const curr = parseFloat(document.getElementById("currentPrice").value);
        const target = parseFloat(document.getElementById("targetPct").value) || 0;

        if (!name || isNaN(qty)) return;

        investments.push({ name, quantity: qty, buyPrice: buy, currentPrice: curr, targetPct: target });
        save(); render();
        
        // Ryd felter
        ["name", "quantity", "buyPrice", "currentPrice", "targetPct"].forEach(id => document.getElementById(id).value = "");
    }

    function deleteInvestment(index) {
        if(confirm("Vil du slette denne investering?")) {
            investments.splice(index, 1);
            save(); render();
        }
    }

    async function updateAllPrices() {
        const btn = document.getElementById("updateBtn");
        btn.textContent = "Henter priser...";
        btn.disabled = true;

        for (let i = 0; i < investments.length; i++) {
            try {
                const res = await fetch(`https://corsproxy.io/?https://query1.finance.yahoo.com/v7/finance/quote?symbols=${investments[i].name}`);
                const data = await res.json();
                if (data.quoteResponse.result[0]) {
                    investments[i].currentPrice = data.quoteResponse.result[0].regularMarketPrice;
                }
            } catch (e) { console.error("Fejl:", e); }
        }
        save(); render();
        btn.textContent = "üîÑ Opdater live-priser";
        btn.disabled = false;
    }

    async function loadNews() {
        const newsList = document.getElementById("newsList");
        if (investments.length === 0) { 
            newsList.innerHTML = "Ingen aktier i portef√∏ljen. Tilf√∏j tickers som f.eks. 'AAPL' eller 'NOVO-B.CO'."; 
            return; 
        }
        
        newsList.innerHTML = "Henter de seneste nyheder...";
        const tickers = investments.map(i => i.name).join(',');
        
        try {
            const res = await fetch(`https://corsproxy.io/?https://query1.finance.yahoo.com/v1/finance/search?q=${tickers}`);
            const data = await res.json();
            const news = data.news || [];
            
            if (news.length === 0) {
                newsList.innerHTML = "Ingen nyheder fundet for dine tickers.";
                return;
            }

            const df = new Intl.DateTimeFormat('da-DK', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' });

            newsList.innerHTML = news.map(item => {
                const pubDate = new Date(item.providerPublishTime * 1000);
                return `
                    <div class="news-item">
                        <a href="${item.link}" target="_blank" class="news-title">${item.title}</a>
                        <div class="news-meta">
                            <span class="news-date">üìÖ ${df.format(pubDate)}</span>
                            <span>Kilde: <b>${item.publisher}</b></span>
                        </div>
                    </div>
                `;
            }).join('');
        } catch (e) {
            newsList.innerHTML = "Kunne ikke hente nyheder. Tjek din internetforbindelse.";
        }
    }

    function render() {
        let totalInvested = 0, totalValue = 0;
        investments.forEach(i => {
            totalInvested += i.quantity * i.buyPrice;
            totalValue += i.quantity * i.currentPrice;
        });
        const profit = totalValue - totalInvested;
        const profitPct = totalInvested ? (profit / totalInvested) * 100 : 0;

        document.getElementById("invested").textContent = fmt.format(totalInvested);
        document.getElementById("value").textContent = fmt.format(totalValue);
        
        const pEl = document.getElementById("profit");
        pEl.textContent = fmt.format(profit);
        pEl.className = profit >= 0 ? "positive" : "negative";

        const pctEl = document.getElementById("profitPct");
        pctEl.textContent = profitPct.toFixed(2) + "%";
        pctEl.className = profitPct >= 0 ? "positive" : "negative";

        const tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = investments.map((i, idx) => {
            const val = i.quantity * i.currentPrice;
            const pct = totalValue ? (val / totalValue * 100) : 0;
            const targetVal = totalValue * (i.targetPct / 100);
            const diff = targetVal - val;
            return `<tr>
                <td><b>${i.name}</b></td>
                <td>${fmt.format(val)}</td>
                <td>${pct.toFixed(1)}%</td>
                <td>${i.targetPct}%</td>
                <td class="${diff >= 0 ? 'positive' : 'negative'}">${fmt.format(diff)}</td>
                <td><button class="btn-delete" onclick="deleteInvestment(${idx})">Slet</button></td>
            </tr>`;
        }).join('');
    }

    render();
</script>
</body>
</html>
